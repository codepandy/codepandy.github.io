<!DOCTYPE html><html lang="[&quot;zh-Hans&quot;,&quot;zh-CN&quot;,&quot;default&quot;]"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="webkit技术内幕笔记"><meta name="keywords" content="JavaScript"><meta name="author" content="wenmu"><meta name="copyright" content="wenmu"><title>webkit技术内幕笔记 | 温木的博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="http://ta.qq.com"><script>(function() {
   var hm = document.createElement("script");
   hm.src = "https://tajs.qq.com/stats?sId=&lt;script type=&quot;text/javascript&quot; src=&quot;http://tajs.qq.com/stats?sId=66523541&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;";
   var s = document.getElementsByTagName("script")[0];
   s.parentNode.insertBefore(hm, s);
 })();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么说函数是一等公民"><span class="toc-number">1.</span> <span class="toc-text">为什么说函数是一等公民</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态类型语言"><span class="toc-number">2.</span> <span class="toc-text">动态类型语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript-和-C-语言的区别："><span class="toc-number">3.</span> <span class="toc-text">JavaScript 和 C++语言的区别：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JIT"><span class="toc-number">4.</span> <span class="toc-text">JIT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#闭包"><span class="toc-number">5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript-引擎"><span class="toc-number">6.</span> <span class="toc-text">JavaScript 引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化回滚"><span class="toc-number">7.</span> <span class="toc-text">优化回滚</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://i.loli.net/2020/02/27/xwaBoOj158MfNyq.jpg"></div><div class="author-info__name text-center">wenmu</div><div class="author-info__description text-center">记录一些在工作中或学习新知识时学到的一些知识点；正所谓好记性不如一个烂笔头，温故而知新！</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">105</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">51</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">29</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">温木的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">首页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div><div id="post-info"><div id="post-title">webkit技术内幕笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/JavaScript/">JavaScript</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="为什么说函数是一等公民"><a href="#为什么说函数是一等公民" class="headerlink" title="为什么说函数是一等公民"></a>为什么说函数是一等公民</h3><blockquote>
<p>因为函数能够当做参数或返回值进行传递。</p>
</blockquote>
<h3 id="动态类型语言"><a href="#动态类型语言" class="headerlink" title="动态类型语言"></a>动态类型语言</h3><p><code>Javascript</code>语言的另一个重大特点就是，它是一种<strong>无类型语言</strong>，或者说是<strong>动态类型语言</strong>。相比较而言，C++或者 Java 等语言都是静态类型语言，它们在编译的时候就能够知道每个变量的类型。但是，JavaScript 的语言特性让我们没有办法在编译的时候知道<code>变量的类型</code>，所以只能<code>在运行的时候才能确定</code>，这导致 JavaScript 语言的规范面临着性能方面的巨大压力。<code>在运行时计算和决定类型，会带来很严重的性能损失</code>，这导致了 JavaScript 语言的运行效率比 C++或者 Java 都要低很多。 ###为什么这样会比静态类语言性能差<br>因为静态类型语言在编译时，就已经知道了参数的类型，并根据类型生成了<code>本地代码</code>；所以运行的时候从本地代码中读取就比较快。<br>而 javascript 是动态类型语言，只有当运行的时候才去编译、运行，上面的工作才开始做，这样效率当然会比较低了。</p>
<a id="more"></a>

<h3 id="JavaScript-和-C-语言的区别："><a href="#JavaScript-和-C-语言的区别：" class="headerlink" title="JavaScript 和 C++语言的区别："></a>JavaScript 和 C++语言的区别：</h3><ul>
<li><strong>编译确定位置：</strong>C++有明确的两个阶段，而编译这些位置的偏移信息都是编 译器在编译的时候就决定了的，当 C++代码编译成本地代码之后，对象的 属性和偏移信息都计算完成。<code>因为JavaScript没有类型，所以只有在对象创建的时候才有这些信息，因而只能在**执行阶段**确定，</code>而且 JavaScript 语言能够在执行时修改对象的属性（不是属性值，而是添加或者删除属性本身）。</li>
<li><strong>偏移信息共享：</strong>C++因为有类型定义，所以所有对象都是按照该类型来确定 的，而且不能在执行的时候动态改变类型，因为这些对象都是共享偏移信息 的。访问它们只需要按照编译时确定的偏移量即可。而对于 C++模板的支 持，其实是多份代码，因为本质上其道理是相同的。<code>JavaScript则不同，每 个对象都是自描述，属性和位置偏移信息都包含在自身的结构中。</code></li>
<li><strong>偏移信息查找：</strong>C++中查找偏移地址很简单，都是在编译代码时，对使用到 某类型的成员变量直接设置偏移量。而对于 JavaScript,使用到一个对象则需要通过<code>属性名匹配</code>才能查找到对应的值，这实在太费时间了。</li>
</ul>
<h3 id="JIT"><a href="#JIT" class="headerlink" title="JIT"></a>JIT</h3><p>推动 JavaScript 运行速度提高的另一大利器是 JIT (Just-In-Time)技术，它不是 一项全新的技术，其作用是解决解释性语言的性能问题，主要思想是当解释器将源 代码解释成内部表示的时候（Java 字节码就是一个典型例子），JavaScript 的执行环境不仅是解释这些内部表示，而且将其中一些字节码（主要是使用率高的部分）转成本地代码（汇编代码），这样可以被 CPU 直接执行，而不是解释执行，从而极大地提高性能。JIT 技术被广泛地使用在各种语言的执行环境中，例如 Java 虚拟机，经过长时间的演进之后，目前使用在 JavaScript 的众多引擎中，例如 JavaScriptCore、V8、SpiderMonkey 等中。</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>首先介绍一个学术解释，“闭包是一个拥有许多变量和绑定了这些变量的环境的 表达式（通常是一个函数），因而这些变量也是该表达式的一部分”。</p>
<p>通俗来说，就是当执行到一条语句的时候，哪些对象（或者其他环境因素）能够被使用。JavaScript 使用作用域链来实现闭包，作用域链由执行环境维护，JavaScript 中所有的标识符都是通过作用域链来查找值的。</p>
<h3 id="JavaScript-引擎"><a href="#JavaScript-引擎" class="headerlink" title="JavaScript 引擎"></a>JavaScript 引擎</h3><p>什么是 JavaScript 引擎？简单来讲，就是能够将 JavaScript 代码处理并执行的运行环境。要解释这一概念，需要了解一些编译原理的基础概念和现代语言需要的一些新编译技术。</p>
<p>JavaScript 和 java 的区别：</p>
<p>其一是类型。JavaScript 是无类型的语言,其对于对象的表示和属性的访问比 Java 存在更大的性能损失。不过现在已经出现了一些新的技术，参考 C++或者 Java 的类型系统的优点，构建隐式的类型信息，这些后面将逐一介绍。</p>
<p>其二，Java 语言通常是将源代码编译成字节码，这同执行阶段是分开的，也就是从源代码到抽象语法树再到字节码这段时间的长短是无所谓的（或者说不是特别 重要），所以尽可能地生成高效的字节码即可。而对于 JavaScript 而言，这些都是在网页和 JavaScript 文件下载后<code>同执行阶段</code>一起在网页的加载和渲染过程中来实施的， 所以对它们的处理时间也有着很高的要求。</p>
<p>JavaScript 引擎包括以下几个部分：</p>
<blockquote>
<ul>
<li><strong>编译器。</strong>主要工作是将源代码编译成抽象语法树，在某些引擎中还包含将抽 象语法树转换成字节码。</li>
<li><strong>解释器。</strong>在某些引擎中，解释器主要是接收字节码，解释执行这个字节码, 同时也依赖垃圾回收机制等。</li>
<li><strong>JIT 工具。</strong>一个能够能够 JIT 的工具，将字节码或者抽象语法树转换成本地 代码，当然它也需要依赖牢记</li>
<li><strong>垃圾回收器和分析工具（Profiler )。</strong>它们负责垃圾回收和收集引擎中的信息,帮助改善引擎的性能和功效。</li>
</ul>
</blockquote>
<h3 id="优化回滚"><a href="#优化回滚" class="headerlink" title="优化回滚"></a>优化回滚</h3><p>前面提到 V8 引擎为了性能上的优化，引入了更为高效的 Crankshaft 编译器。但 是为了性能考虑，该编译器通常会做比较乐观和大胆的预测，那就是编译器认为这 些代码比较稳定，变量类型不会发生改变，所以能够生成高效的本地代码。当然这 是理想情况，现实是引擎会发现一些变量的类型已经发生变化。在这种情况下，V8 使用一种机制来将它做的这些错误决定回滚到之前的一般情况，这个过程称为优化 回滚。<br>下面举个例子来说明为什么会出现这种情况吧。示例代码介绍了其中一种情况，函数 ABC 被调用很多次之后， VS 引擎可能会触发 Crankshaft 编译器来生成优化的代码，优化的代码认为示例代码的类型等信息都己经被获知了。但事实上，到目前为止，我们对于代码中的 unknown 变量的类型还一无所知，在这种情况下， VS 只能将该段代码回滚到一个通用的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> counter=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ABC</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">	counter++;</span><br><span class="line">    <span class="keyword">if</span>(counter&lt;<span class="number">1000</span>)&#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">var</span> unknown=<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    print(unknown)</span><br></pre></td></tr></table></figure>

<p>优化回滚是一个很费时的操作，所以能够不回滚，肯定不要回滚，而且回滚会将之前优化的代码恢复到一个没有经过特别优化的代码，这是一个非常不高效的过程，写代码的时候要特别注意尽量不要触发这一过程。</p>
<p>《webkit 技术内幕》第九章</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">wenmu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.wangpengpeng.site/2020/02/28/webkit%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%E7%AC%94%E8%AE%B0/">http://blog.wangpengpeng.site/2020/02/28/webkit%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.wangpengpeng.site">温木的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://i.loli.net/2020/02/27/hOBzIxFDJMCrmtN.jpg"><div class="post-qr-code__desc">微信打赏</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/28/javascript%E7%9A%84delete%E5%B1%9E%E6%80%A7/"><i class="fa fa-chevron-left">  </i><span>javascript的delete属性</span></a></div><div class="next-post pull-right"><a href="/2020/02/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E9%98%B2%E5%BE%A1%E6%8A%80%E5%B7%A7-%E7%AC%94%E8%AE%B0/"><span>web前后端漏洞分析与防御技巧--笔记</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By wenmu</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv">该文访问量<span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>